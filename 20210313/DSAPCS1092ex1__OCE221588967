//OCE221588967林玉潔
#include <iostream>															        //必要標頭檔, 勿移除！
#include <iomanip>
#include <new>
#include <cstdio>
#include <cstdlib>
#include <string>

using namespace std;																// 標準函式庫的命名空間, 勿移除！
#define OUTPUT_NO   1000															// 輸出筆數的批次單位 

// (1) 填入下方函數所需的參數列可使編譯成功 

void solveF(unsigned long);																		// 任務一

unsigned long getN(int, unsigned long);																// 輸入指定範圍內的一個整數  
bool openData(int);																	// 動態配置二個陣列的空間 
void PermutationN(int, int);																// 任務二
void outputSeries(void);															// 輸出一筆結果 
void closeData(void);																// 釋放動態陣列的空間 
// 以上是N個相異數列的非遞迴函式宣告。

bool            *used = NULL;														// 表示是否使用的布林值 T,F 
int             *ans = NULL;														// 紀錄目前的一筆結果 
unsigned long   N, num, last;  //unsinged long與int功能相同 
// 以上是全域變數

int main(void)
{   int     command = 0;													   		// 操作指令
// ---------------------- 操作介面 ----------------------
    do {    num = 0;
            last = 1;
            cout << endl << "***** 指令介面 *****";   //endl: end of line 換行符號 
            cout << endl << "* 0. 終止程式      *";
            cout << endl << "* 1. 計算指定數列  *";
            cout << endl << "* 2. 各種相異排列  *";
            cout << endl << "********************";
			cout << endl << "輸入選項(0, 1, 2): ";
	    	cin >> command;															//嘗試讀取操作指令
            switch (command)
			{	case 0: break;
			    case 1: N = getN(0, 999999999);                                 	// 取得輸入整數N值
                        solveF(N);													// 任務一
                        break;
			    case 2:	// 列舉從1,2,3..n個不同數字形成的所有「相異」數列
                        N = getN(2, 12);                                        	// 取得輸入整數N值,限定2-12之間 
                        for (int i = 2; i <= N; i++)
                            last *= i;												// 排列總數
                        if (openData(N))                                  		// 建立暫存資訊的陣列
                            PermutationN(N, 0);										// 任務二,指定level從0開始 
                        closeData();                                             	// 釋放暫存資訊的空間
                        break;
                default: cout << endl << "Command does not exist!" << endl;
			}	// end switch
    } while (command != 0); 													 	// 指令'0': 結束主程式
	system("pause");																// 暫停畫面
    return 0;
}	//主程序結尾
//**************************************************************************************************************************/

//任務一 
void solveF(unsigned long value)
{   unsigned long sum;
    cout << endl << "輸出: ";
    while (value / 10)									// 不只是單一的個位數字,檢查幾位數 
    {
        cout << value << ", ";
        sum = 0;
        while (value > 0)
        {
// (2) 填寫下方二行敘述可完成任務一 
            sum = sum + (value % 10); 	// 加入最右側的一個數字 
			value = int(value / 10);	// 去掉最右側的一個數字	
		//	cout<<sum<<", ";												 																		 
        }   // end inner-while
        value = sum;									// 本回合的加總數字 
    }   // end outer-while
    cout << value << endl;  //印出最後一個 
}   // end solveF
//**************************************************************************************************************************/

//任務二 
unsigned long getN(int minM, unsigned long maxM)
{   unsigned long   M;
    string          inputS;
    bool            isNum;
    do {
        cout << endl << "輸入: ";
        cin >> inputS;
        isNum = true;
        for (int i = 0; i < inputS.length(); i++)
// (3) 填寫下方二行if敘述的條件可完成此函數 
            if ( inputS[i]<'0' ||  inputS[i]>'9' )							// 在'0'~'9'範圍之外就是非數字 
                isNum = false;  //令該數字為false 
        if (!isNum)
            continue;
        M = strtoul(inputS.c_str(), NULL, 10);										// 將字串轉存成長整數 
        if (M>=minM && M<=maxM)																	// 確認數字 
            break;																	// 在限制範圍內才算完成 
        else
            cout << endl << "### 數字需介於 [" << minM << "," << maxM << "] ###" << endl;
    } while (true);   // end do-while
  //  cout <<M<<" ";
	return M;										                           	
}   // end getM

bool openData(int arraySize)
{   try {
	// (4) 填寫下方二行敘述可完成ans變數的動態配置和給定初始值 
        used = new bool [arraySize];												// 動態配置陣列存布林值
        ans = new int [arraySize];													// 動態配置陣列存數字
        for (int i = 0; i < arraySize; i++)
        {   used[i] = false;														// 預設值表示尚未使用 
            ans[i] = i;																// 預設值0代表目前都放入數字1
        }   // end for
    }	// end try
    catch (std::bad_alloc& ba)														// 配置空間失敗
    {   std::cerr << endl << "bad_alloc caught: " << ba.what() << endl;
        return false;
    }   // end catch
    return true; 
}   // end openData

void PermutationN(int N, int level)
{   
	if (level < N)
	{ 
		for (int i = 0; i < N; i++)
			if (!used[i])
			{	ans[level] = i;
				used[i] = true;
			 	PermutationN(N, level+1);
			 	used[i] = false;
			}  //end for-if
	}  //end if
    else																	// 遞增level終究會等於N
    {
		num++;																// 增加一筆結果 
    	if ((N <= 6) || (num <= N) || (!(num % OUTPUT_NO)) || (num == last))	// 前幾筆、批次、最後一筆 
        	outputSeries();													// 印出結果
    } 
}   // end PermutationN

void outputSeries(void)
{
    cout << "[" << num << "]";														// 目前筆數 
    for (int i = 0; i < N; i++)
        cout << " " << ans[i] + 1;													// 從0開始的索引需要加一 
    cout << endl;
}   // end outputSeries

void closeData()
{   delete [] used;																	// 釋放動態配置的空間 
	delete [] ans;
}   // end closeData

//**************************************************************************************************************************/
// 以上是N個相異數列的非遞迴函式
//**************************************************************************************************************************/
